<!doctype html>
<html lang="es">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width,initial-scale=1"/>
  <title>Prueba QR ‚Ä¢ CDN</title>

  <!-- 1) Librer√≠a desde CDN (ruta correcta con /dist/) -->
  <script src="https://unpkg.com/html5-qrcode@2.3.10/dist/html5-qrcode.min.js"></script>

  <style>
    body{font-family:system-ui;background:#0b1220;color:#e5e7eb;margin:0;padding:16px}
    .card{max-width:720px;margin:auto;background:#0f172a;border:1px solid #1f2937;border-radius:14px;padding:16px}
    #reader{width:100%;min-height:320px;background:#0b1220;border-radius:12px;border:1px dashed #334155}
    button{padding:10px 14px;border-radius:10px;border:1px solid #1f2937;background:#111827;color:#e5e7eb;cursor:pointer;margin-right:8px}
    .status{margin-top:12px;padding:12px;border-radius:10px;text-align:center}
    .ok{background:#022c22;color:#a7f3d0;border:1px solid #065f46}
    .bad{background:#2b0d0d;color:#fecaca;border:1px solid #991b1b}
  </style>
</head>
<body>
  <div class="card">
    <h1>üì∑ Prueba Lector QR (CDN)</h1>
    <div id="reader"></div>
    <div style="margin-top:10px">
      <button id="start">Iniciar c√°mara</button>
      <button id="stop">Detener</button>
    </div>
    <div id="out" class="status">Listo</div>
  </div>

  <!-- 2) Tu script (VA DESPU√âS de la librer√≠a) -->
  <script>
    const out = (m,cls="ok")=>{
      const el=document.getElementById("out");
      el.className="status "+cls;
      el.textContent=m;
    };

    let qr, cameras=[], idx=0, last="", lastAt=0;

    function onScan(text){
      const now=Date.now();
      if (text===last && (now-lastAt)<1500) return; // evita duplicados
      last=text; lastAt=now;
      out("Le√≠do: "+text,"ok");
      // aqu√≠ har√≠as tu validaci√≥n‚Ä¶
    }

    async function start(){
      try{
        // 3) Verificamos que la librer√≠a est√© cargada
        if (typeof window.Html5Qrcode === "undefined") {
          out("Librer√≠a de QR no se carg√≥ (revisa el <script> del CDN).","bad");
          return;
        }
        if (!qr) qr = new Html5Qrcode("reader");
        cameras = await Html5Qrcode.getCameras();
        if (!cameras.length) throw new Error("No hay c√°mara disponible");
        await qr.start(
          { deviceId:{ exact:cameras[idx].id } },
          { fps:12, qrbox:250 },
          onScan
        );
        out("C√°mara iniciada","ok");
      }catch(e){
        out("No se pudo iniciar la c√°mara: "+e.message,"bad");
      }
    }

    async function stop(){
      try{ await qr?.stop(); await qr?.clear(); out("C√°mara detenida","ok"); }catch(_){}
    }

    document.getElementById("start").onclick = start;
    document.getElementById("stop").onclick  = stop;
  </script>
</body>
</html>
